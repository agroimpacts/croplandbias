---
title: "Pre-processing cropland datasets"
author: "Lyndon Estes"
date: "29 September 2014"
output:
  html_document:
    toc: yes
    theme: spacelab
---

## Introduction
<!-- This analysis was undertaken to determine the bias in satellite-derived landcover products at different
spatial scales, using GeoTerraImage's cropland maps for South Africa to assess this error.-->
The following describes the initial pre-processing of landcover datasets that was undertaken for an analysis 
of bias in landcover data. 

## Gridding the SA landcover data
Much of the original analysis was undertaken on the Mapping Africa server, using postgis/postgres as well as
pprepair to do much of the cleaning and conversion of the GTI dataset into a 1 km resolution cropland 
percentage cover dataset. The following steps were taken: 

### Cleaning up fields in GTI data
This was done for both the 2007 and 2011 datasets, using a script that pulled out the fields, found the bad 
ones, read them into an R data object, ran pprepair over it, and then stuck the cleaned geometries back into 
a postgis table holding the full dataset. The intersection was then performed. 

```{r, eval = FALSE}
source("R_ext/grid-fields-intersect-postgis.R")  # this was run on mapper.princeton.edu
```

The next step was running 

```{r, eval = FALSE}
source("R_ext/grid-fields-intersect-analyze.R")  # this was run on mapper.princeton.edu
```

To calculate the area for different cropcover classes in each 1 km$^2$ pixel.  This created two core gridded
datasets, cover2007.tif and cover2011.tif. 

### Processing global landcover products
A few global landcover datasets were then fetched.  The MODIS 2011 landcover product for South Africa was 
downloaded, the GLC-SHARE dataset, the 2009 GlobCover product, and then South Africa's 2009 landcover product. 
These were converted to 1 km$^2$ percentage cropland estimates after making several versions of MODIS and 
GlobCover products to account for mixed cropland classes.  A further processing was applied to the two GTI
derived cover images.  

```{r, eval = FALSE}
source("R_ext/fetch-land-cover.R")  # this was run on mapper.princeton.edu
```








