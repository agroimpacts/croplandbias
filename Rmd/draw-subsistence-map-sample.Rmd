---
title: "Select subsistence mapping sample"
author: "Lyndon Estes"
date: "24 November 2014"
output: 
  html_document:
    highlight: tango
    theme: spacelab
    toc: yes 
---

##Selecting areas for mapping in small-scale/subsistence cropland
GTI did not map communal farmlands with the same precision as commercial and other croplands in SA, so we need to come up with a sub-sample of these areas for further mapping and analysis. _Note: This will probably go into another project eventually._

```{r, eval = FALSE}
library(raster)
library(lmisc)
p_root <- proj_root("SAcropland")
p_fig <- full_path(p_root, "SAcropland/external/figures/")
p_data <- full_path(p_root, "SAcropland/external/ext_data/")
```

Load in GTI2011 dataset, the SA grid (which provides the grid IDs for the whole country), and then multiple the two to assign sample IDs to just the subsistence/communal farming areas
```{r, eval = FALSE}
cover2011 <- brick(full_path(p_data, "cover2011.tif"))

# load in SA grid
sagrid <- brick(full_path(p_data, "sagrid.tif"))

subs_crops <- cover2011[[2]] > 0  # select those areas
subs_crops[subs_crops == 0] <- NA
projection(subs_crops) <- projection(sagrid)

# create sample ids for the subsistence areas
subs_sids <- subs_crops * sagrid
#subsgrid <- subs_sids
```

Pull a random sample from those, and convert to polygons
```{r, eval = FALSE}
set.seed(234)
samp <- sampleRandom(subs_sids, 200, na.rm = TRUE, asRaster = TRUE)
subsgrid[!subsgrid %in% samp] <- NA
subs_polys <- rasterToPolygons(samp, dissolve = TRUE)
colnames(subs_polys@data) <- "ID"
subs_polys$name <- paste("SA", subs_polys$ID, sep = "")
writeOGR(subs_polys, dsn = full_path(p_data, "SA_subsistence_sample.sqlite"), "SA_subs", driver = "SQLite", 
         dataset_options = c("SPATIALITE = yes"))
#writeOGR(obj = subs_polys, dsn = p_data, "SA_subsistence_sample", driver = "ESRI Shapefile")  # identical

```

Then create a template for mapping fields in QGIS (with openlayers plugins providing the satellite imagery, as with mappingafrica.princeton.edu), and also do a randomized reduction of the initial draw of 200 (down to 100). This preserves a larger draw if we find we need more than 100 mapped samples. 
```{r, eval = FALSE}
map_polys <- subs_polys[1, ]
map_polys$fid <- 1

set.seed(234)
subs100 <- sample(subs_polys$ID, size = 100, replace = FALSE)
write <- write(subs100, file = full_path(p_data, "fields100.txt"))

writeOGR(subs_polys[subs_polys$ID %in% subs100, ], dsn = full_path(p_data, "SA_subsistence_sample100.sqlite"),
         "SA_subs100", driver = "SQLite", dataset_options = c("SPATIALITE = yes"))



```


